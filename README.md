## Описание
---
Проект `PlatformIO` для реализации регулятора давления на основе микроконтроллера `Arduino Uno R3`.
#### Программная часть
---
Программа [[src/main.cpp]] реализована для двухканального управления *клапан-датчик давления* с возможностью расширения размерности.

 Управление микроконтроллера выполняется через последовательный `COM` порт с использованием `API` для среды `MATLAB` [[ardreg.m]]. 
 Примеры использования содержатся в файле [[ses.m]].

```octave
% инициализация экземпляра класса `ardreg` с указанием подключенного последовательного порта `COM4` 
mcu = ardreg('COM4');
```

```octave
% инициализция регулятора канала `0` с пороговой амплитудой сигнала с АЦП `threshold=300`, невязкой `discrepancy=50` и задержкой между изменением состояния клапана `deadtime=100` (величины задаются в отчетах)
mcu = mcu.control(0,true,threshold=300,discrepancy=50,deadtime=100);
```

```octave
% инициализация двух регуляторов: каналы `0` и `1`
mcu = mcu.control(0,true,threshold=300,discrepancy=50,deadtime=100);
mcu = mcu.control(1,true,threshold=500,discrepancy=100,deadtime=100);
```

```octave
% остановка регулятора
mcu = mcu.control(0,false);
```

```octave
% мониторинг управления
mcu.monitor(channel=[0,1]) % press `ESC` key to safely terminate loop
```

> [!danger]
> При использовании метода `monitor()`, чтобы выйти из бесконечного цикла реализована функция обратного вызова, срабатывающая по нажатию клавиши `Ecs`, когда `MATLAB` фигура находится в выделенном состоянии. Использование прерывания цикла сочетанием клавиш `Ctrl+C` может повлиять на транзакцию пакетов с микроконтроллером, в этом случае необходимо заново инициализировать объект `ardreg`.
##### Аппаратная часть
---
Используются датчики давления с униполярным аналоговым выходом 0-5В, питание постоянным напряжением 5В.
Оцифровка сигнала давления выполняется АЦП микроконтроллера через мультиплексор `HP4067`.
Коммутация электромагнитных клапанов производится через твердотельные реле, срабатывающие по фронту логического сигнала.
В микроконтроллере реализованы несколько подходов управления:
1. `FIR`
2. $|pressure-threshold|<discrepancy$

Активным алгоритмом управления является 2-ой. Чтобы избежать залипание клапана используется таймер, отчитывающий моменты смены состояния, который задается параметром `deadtime`.

> [!important] Твердотельная модель корпуса для электроники выполнена в среде Компас 3D
> - [[box-ground.m3d]]
> - [[box-cap.m3d]]
> - [[box-assembly.a3d]]
